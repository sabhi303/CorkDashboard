extends layout
//- include component/card-rt
include component/home__card-chart
include component/home__card-indicator

//- abhi
include component/home_about_cards

block append head
  //- link(rel="stylesheet" href="https://unpkg.com/flickity@2/dist/flickity.min.css" )
  link(rel="stylesheet", href="/stylesheets/lib/flickity.min.css")
  //- link(rel="stylesheet", href="/stylesheets/lib/flickity.css")  
  link(rel="stylesheet", href="/stylesheets/home/home.css")
  link(rel="stylesheet", href="/stylesheets/home/home-carousel.css")
  link(rel="stylesheet", href="/stylesheets/home/card.css" )
  link(rel="stylesheet", href="/stylesheets/home/home-about.css")
  script(src='/lib/d3v5/d3.min.js' type="text/javascript" defer)
  script(src="/lib/flickity.pkgd.min.js" type="text/javascript" defer)
  //- script(src='javascripts/home/flickity_utils.js' type="text/javascript")
  script(src="https://unpkg.com/set-interval-async" type="text/javascript" defer)
  script(src='javascripts/home/card_time.js' type="text/javascript" defer)
  script(src='javascripts/home/card_weather_current.js' type="text/javascript" defer)
  script(src='javascripts/home/about_regions.js' type="module")

  //- abhi, not deferring it
  //- script(src='javascripts/home/text_from_db.js' type="module")

//- block navigation

block content
  #home-page  
    .colour-banner 
    #hero 
      #hero-grid
          #hero-title
              #hero-title__text--top CORK
              #hero-title__text--bottom DASHBOARD
          #hero-time-weather
              #hero-time
                  #hero-time__box  
                      #hero-time__clock  
                      #hero-time__date
              #hero-weather
                  include home/hero__card-weather
        
          #hero-carousel
              <div class="carousel" data-flickity='{ "freeScroll": true, "wrapAround": false, "freeScrollFriction": 0.05,"selectedAttraction": 0.05, "cellSelector": ".carousel-cell", "cellAlign": "left", "percentPosition": false, "pageDots": true, "adaptiveHeight": false, "setGallerySize": false}'>
                  
                  .carousel-cell
                    +home__card-indicator({
                        title: 'Car parks - city',
                        subtitle:  'Fetching data...',
                        id: 'car-parks-card',
                        icon: '/images/icons/icons-48px/Car_Icon_48px.svg#Layer_1',
                        info: '',
                        buttons: [
                        {
                          href :'/queries/live-travel',
                          name:'Live map',
                          target: ''
                        }],
                        displayoptions:{
                          displayid: 'car-parks-card__display',
                          data:{
                          href: '/api/carparks/latest',
                          },
                          src: '/javascripts/home/card_car_parks.js',
                          format:''
                        }
                      })
                  //- .carousel-cell
                  //- +home__card-indicator({
                  //-     title: 'Air quality - city',
                  //-     subtitle:  'Fetching data...',
                  //-     id: 'air-quality-card',
                  //-     icon: '/images/icons/air-pollution.svg#Layer_1',
                  //-     info: '',
                  //-     buttons: [
                  //-     {
                  //-       href :'https://erc.epa.ie/real-time-air/www/aqindex/aqih_json.php',
                  //-       name:'EPA source data',
                  //-       target: '_blank'
                  //-     }],
                  //-     displayoptions:{
                  //-       displayid: 'air-quality-card__display',
                  //-       data:{
                  //-       href: '/api/air-quality/latest',
                  //-       },
                  //-       src: '/javascripts/home/card_air_quality.js',
                  //-       format:''
                  //-     }
                  //-   })
                  .carousel-cell
                    +home__card-chart({
                        title: 'house prices',
                        subtitle:  'city & county average',
                        id: 'house-prices-card',
                        info: 'The average house price for Cork city and county fell significantly following the financial crisis of 2008 and has only recently recovered to 2010 levels',
                        buttons: [{
                          href :'/themes/#average-house-prices',
                          name:'More in THEMES'
                        }],
                        plotoptions:{
                          chartid: 'house-prices-card__chart',
                          data:{
                          href: '../data/static/HPM05.json',
                          },
                          src: '/javascripts/home/card_house_prices.js',
                          format:''
                        }
                      })
                  .carousel-cell
                    +home__card-chart({
                        title: 'population',
                        subtitle:  'Cork',
                        id: 'population-card',
                        info: 'The population of Cork fell dramatically after the census of 1841, but has recovered steadily in more recent years',
                        buttons: [{
                          href :'/themes#population',
                          name:'More in THEMES'
                        }],
                        plotoptions:{
                          chartid: 'population-card__chart',
                          data:{
                          href: '../data/static/CNA13.json',
                          },
                          src: '/javascripts/home/card_population.js',
                          format:''
                        }
                      })
                  .carousel-cell
                    +home__card-chart({
                        title: 'unemployment rate (%)',
                        subtitle:  'Southern region',
                        id: 'unemployment-card',
                        info: 'The unemployment rate for the Southern region declined from the highs experienced following the financial crisis of 2008. Since 2012 it has decreased by about 12%',
                        buttons: [{
                          href :'/themes#employment',
                          name:'More in THEMES'
                        }],
                        plotoptions:{
                          chartid: 'unemployment-card__chart',
                          data:{
                          href: '../data/static/QLF08.json',
                          },
                          src: '/javascripts/home/card_employment.js',
                          format:''
                        }
                      })
              </div>

          #hero-icon-navs
              include home/hero__icon-nav.pug
              
          #hero-scroll-arrow
              a(href='#about-cork')
                  <svg viewBox="0 0 100 100"><path d="M 10,50 L 60,100 L 70,90 L 30,50  L 70,10 L 60,0 Z" ></path></svg>

    +about-cork({
          header: 'ABOUT CORK',
          area: 'xxx.xx',
          populationYear: 'xxxx',
          populationCount: 'x,xxx,xxx',
          populationChange: 'xx%',
          populationTrendText: 'increasing'
        })
      
    #regions-info.home__about
      #regions-info__map
        svg#map
      //- #regions-info_flex
      #regions-info__cta SELECT A COUNCIL ON THE MAP TO LEARN MORE 
      #regions-info__cta-arrow 
        <svg viewBox="0 0 100 100"><path d="M 10,50 L 60,100 L 70,90 L 30,50  L 70,10 L 60,0 Z" ></path></svg>
      #regions-info__card.home__about__card
        #regions-info__card__header
          h1#local__title 
        #regions-info__card__body
          p 
            span#local__text-1 
            |  covering an area of 
            span#local__area

          p The population determined by the census of 2016 was  
            span#local__curPopulation 
            | , compared to 
            span#local__prePopulation
            |  in 2011. This was 
            span#local__PopChange 
            | . 
            span#local__text-2

          p See more in our <a href='/themes#demographics'>Demographics Theme</a> 
            
    +about-cork-dashboard({
        header: aboutCardsContent["About The Dashboard"].header,
        twitterHandle: aboutCardsContent["About The Dashboard"].twitterHandle,
        description: aboutCardsContent["About The Dashboard"].description,
        additionalInfo: aboutCardsContent["About The Dashboard"].additionalInfo,
        isEditable: isEditable
        })

//- Just tried the following, it works fine, so should not be an issue :)
//-     <script src="https://cdn.jsdelivr.net/gh/CSOIreland/PxWidget@2.8.2/js/isogram.min.js"></script>
//- <script>pxWidget.queue('chart', 'pxwidget5413464941', {"autoupdate":true,"matrix":null,"type":"line","showPercentage":null,"copyright":true,"link":"https://data.cso.ie/table/CNA05","sort":false,"metadata":{"xAxis":{"TLIST(A1)":["2016","2011","2006","2002","1991","1986","1981","1971","1966","1961","1946"],"role":"time"},"fluidTime":[0,1,2,3,4,5,6,7,8,9,10],"api":{"query":{"url":"https://ws.cso.ie/public/api.jsonrpc","data":{"jsonrpc":"2.0","method":"PxStat.Data.Cube_API.ReadMetadata","params":{"matrix":"CNA05","language":"en","format":{"type":"JSON-stat","version":"2.0"}},"version":"2.0"}},"response":{}}},"data":{"labels":[],"datasets":[{"label":"Series 1","pointRadius":2,"pointHoverRadius":4,"maxBarThickness":90,"minBarLength":1,"api":{"query":{"url":"https://ws.cso.ie/public/api.jsonrpc","data":{"jsonrpc":"2.0","method":"PxStat.Data.Cube_API.ReadDataset","params":{"class":"query","id":["STATISTIC","CEROOMS","COUNTYB"],"dimension":{"STATISTIC":{"category":{"index":["CNA05"]}},"CEROOMS":{"category":{"index":["0"]}},"COUNTYB":{"category":{"index":["0202"]}}},"extension":{"language":{"code":"en"},"format":{"type":"JSON-stat","version":"2.0"},"matrix":"CNA05","m2m":false},"version":"2.0"}}},"response":{}},"data":[],"unit":[],"decimal":[],"fluidTime":[],"fill":false}],"null":".."},"options":{"responsive":true,"maintainAspectRatio":false,"title":{"display":true,"text":["Permanent Private Dwellings"]},"tooltips":{"mode":"index","intersect":false,"callbacks":{}},"hover":{"mode":"nearest","intersect":true},"scales":{"xAxes":[{"ticks":{"beginAtZero":false,"maxTicksLimit":null,"reverse":true},"gridLines":{"display":false},"scaleLabel":{"display":true,"labelString":"Year"},"stacked":false}],"yAxes":[{"display":true,"position":"left","id":"y-axis-1","ticks":{"beginAtZero":true},"callback":null,"scaleLabel":{"display":false,"labelString":null},"stacked":false}]},"plugins":{"stacked100":{"enable":false,"replaceTooltipLabel":false},"colorschemes":{"scheme":["#405381","#5BC1A5","#FCBE72","#0091AB","#90989F","#3D5999","#C6CC5C","#579599","#FBAA34","#007780","#B9BEC3","#00AF86","#6BC2C2","#00758C","#FCB053","#6A7794","#A3CCC1","#F68B58","#36A0B3"]}},"legend":{"display":true,"position":"bottom"},"elements":{"line":{"tension":0.4}},"updated":"2020-05-11T11:00:00Z","layout":{"padding":{"left":22,"right":22,"top":0,"bottom":22}}},"datasetLabels":["Series 1"],"plugins":[{}]});</script>
//- <div id="pxwidget5413464941" class="pxwidget"></div>
